<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
Design by Free CSS Templates
http://www.freecsstemplates.org
Released for free under a Creative Commons Attribution 2.5 License

Name       : SquareAway 
Description: A four-column, fixed-width design with dark color scheme.
Version    : 1.0
Released   : 20130804

-->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>SquareAway</title>
<meta name="keywords" content="" />
<meta name="description" content="" />
<link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900|Open+Sans:400,300,600,700,800" rel="stylesheet" />
<link href="default.css" rel="stylesheet" type="text/css" media="all" />
<link href="fonts.css" rel="stylesheet" type="text/css" media="all" />

<!--[if IE 6]><link href="default_ie6.css" rel="stylesheet" type="text/css" /><![endif]-->

</head>
<body>
<div id="logo" class="container">
	<h1><a href="#" class="icon icon-spinner"><span>big data? small yellow duck</span></a></h1>
</div>
<div id="header">
	<div id="menu" class="container">
		<ul>
			<li class="current_page_item"><a href="index.html" accesskey="1" title="">Homepage</a></li>
			<li><a href="about.html" accesskey="1" title="">About</a></li>

		</ul>
	</div>
</div>


<div id="page-wrapper">
	<div id="banner" class="container"><a href="#"><img src="images/skyline.jpg" width="1200"  alt="" /></a></div>

	
	<div id="featured" class="container">
		<div class="box">
			<div class="title">
				<h2>Predicting weekly sales revenues</h2>
			</div>
			<p>
			<hr width=900 align=left>
			<table><tr width=900>
			<a href='https://www.kaggle.com/c/walmart-recruiting-store-sales-forecasting'>Walmart Sales Prediction</a> was a Kaggle 
			competition to predict sales revenues for different departments in 40-odd stores.
			My code is <a href='https://github.com/small-yellow-duck/walmart_sales'>here</a>.
			</tr></table>
			
			<hr width=900 align=left>
			
			<p>

			<table><tr width=900>
			<td width = 900 valign=top>
			<font style="line-height:2.0"> 
			<p>How accurately can weekly sales revenues be predicted? Kagglers were given 140 months of weekly sales data for 80-odd departments in 45 Walmart stores, 
			along with the consumer price index, unemployment rate, temperature, gas price and values for five
			mysterious markdowns. We were asked to predict sales revenue for 39 subsequent weeks. Some of the markdown data
			was missing from the training set and the last 11 weeks of the test data was missing the unemployment
			rate and CPI.
			


			</tr></table>
		</div>
	</div>			


	<div id="featured" class="container">
		<div class="box">	
			<div class="title">
				<h2>Constructing a simple prediction</h2>
			</div>					
			<table><tr width=900>	
			<td width=580 valign=top><font style="line-height:2.0">
			I constructed my first prediction just by using the sales data corresponding to the same weeks in the last
			year of the training data (leaderboard score: 2923). I also intervened to shift sales
			data where there was a peak around Easter: Easter in 2012
			occurs in a different week than Easter in 2011, so I shifted the sales data for the six weeks
			preceding and following Easter in time so that the Easter peaks overlapped.

			<p><p>I adapted the "shift the previous year's sales data" forward approach by reconstructing
			the data so that each row consisted of the <i>i</i>th week's features AND the <i>i</i>-52th week's features and sales.
			Then I invoked generalized linear models in the statsmodels.glm package with 
			the Poisson and Gaussian distributions to exploit the difference in, say, the CPI
			or the fuel price from week <i>i</i>-52 to week <i>i</i> to predict the change in
			sales from week <i>i</i>-52 to week <i>i</i>.
			</td>

			<td valign=top align=left width=300>
			<figure>
			<img src="walmart/data_structure.png" width=300 >
			<figcaption width=300>Data structure</figcaption></figure>
			</td>
			
			</tr>
			</table>
			

			
			
		</div>
	</div>
	
	<div id="featured" class="container">
		<div class="box">	
			<div class="title">
				<h2>Correcting for the number of days since pay-day.</h2>
			</div>	
			
			<table><tr width=900>			
			<td width=450 valign=top><font style="line-height:2.0"> 
			A few departments with large sales (92 in particular) had nice period behaviour on the
			time scale of a month. I hypothesized that sales were correlated to the date that shoppers
			would have received their last paycheque. I also speculated that since the sales week
			ended on a Friday, sales would be higher in a week where people were paid on a Saturday
			than on a Thursday, simply because having 6 days to shop with a flush bank account give more
			people more time to make purchases than having only one day to shop. 
			<p><p>
			I built a simple correction for the time-since-paid by adding a feature, <i>Days_Since_Paid</i>
			and another feature, <i>Days_Since_Paid_gt7</i> (greater than 7), where values of <i>Days_Since_Paid</i>
			larger than 7 were set to 0. This allows two linear models of sales as a function of 
			<i>Days_Since_Paid</i> to be constructed - one for [0 <= <i>Days_Since_Paid</i> <=6] and another for
			the interval [<i>Days_Since_Paid</i> > 6]
			
			
			</td>
			
			<td valign=top align=left width=450>
			<figure>
			<img src="walmart/sales_days_since_payday.png" width=450 >
			<figcaption width=450>Sales as function of days since pay day</figcaption></figure>
			</td>			

			
			</tr>	
			</table>	
				
		</div>
		
	</div>


	<div id="featured" class="container">
		<div class="box">	
			<div class="title">
				<h2>Challenges</h2>
			</div>	
			
			<table><tr width=900>			
			<td width=900 valign=top><font style="line-height:2.0"> 
			Because there was just slightly more than two years worth of data in the training set,
			it was hard to validate models in a meaningful way. I spent a few days to make a simple
			but decent prediction and then I spent a few weeks overfitting and experimenting with
			adjusting the length of the subset of the training data that I used for validation. In addition,
			I also really needed a training set, a validation set for optimizing the set of features
			used to make the prediction and a second validation set for assessing the quality of the
			prediction. This was reasonable to do for "regular" weeks where there was lots of data,
			but not for the interesting weeks with high sales revenues, where there were only two
			data points. Ultimately, I found that the Consumer Price Index was really the only feature
			with much predictive value. 
			<p><p>
			In addition, a linear model is reasonable for weeks where there are no large revenue peaks,
			but it's not particularly realistic to expect the model to extrapolate to the week of Thanksgiving or the 
			week before Christmas.
			<p><p>
			It was also difficult to extrapolate missing Markdowns and features:
			The CPI could be predicted by linear extrapolation, bit there was no reasonable way to 
			extrapolate the Fuel Price for the final 11 weeks where this feature was missing from test data.
			<p><p>
			I suspect that temperature would have a stronger predictive effect if it were reported on
			a daily basis rather than on a weekly basis. People might avoid going out on a bitterly 
			cold day, but they won't avoid going out for a whole week of chilly weather.

			
			</tr>	
			</table>	
				
		</div>
		
	</div>


</div>



<div id="copyright">
	<p>Copyright (c) 2013 small yellow duck. All rights reserved. Design by <a href="http://www.freecsstemplates.org/" rel="nofollow">FreeCSSTemplates.org</a>.</p>
</div>
</body>
</html>